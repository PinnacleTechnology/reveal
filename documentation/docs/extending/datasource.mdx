---
id: datasource
title: Use a custom data source
description: Shows how to write a data source to customize how Reveal reads data.
---

import useBaseUrl from '@docusaurus/useBaseUrl';


Reveal is designed to retrieve data from [Cognite Data Fusion (CDF)](https://docs.cognite.com/cdf/).
In certain scenarios it might be useful to customize how Reveal retrieves data, to e.g.:

- Introduce application specific caching to reduce network traffic
- Improve responsiveness in areas with limited connectivity
- Introduce extra logging of network activity related to 3D
- Store models locally

Note that certain features relies on connectivity to CDF and won't work without a connection.

## Overview

To implement a custom data source, [DataSource from @cognite/reveal/extensions/datasource](../API%20Reference#interfaces_cognite_reveal_extensions_datasourcedatasourcemd) must be implemented
and provided to `Cognite3DViewer` on construction using the [`customDataSource`-option](../API%20Reference#customdatasource), which in turn
provides instances of three interfaces:

| Interface               | Description                                                                                                   |
| ----------------------- | ------------------------------------------------------------------------------------------------------------- |
| `ModelDataProvider`     | Access to geometry files and JSON description files for 3D models given URLs.                                 |
| `ModelMetadataProvider` | Provides access to metadata about models, including "base URL", camera information and model transformation.  |
| `NodesApiClient`        | Provides access to metadata about 3D nodes, such as bounding box and ancestors.                               |

Some of the interface functions are required, some are optional at the cost of reduced functionality in Reveal. See details below.

## ModelDataProvider

`ModelDataProvider` is responsible for receiving files by URL.

| Function/Field          | Required?                                  | Description                                                      |
| ----------------------- | ------------------------------------------------------------------------------------------------------------- |
| `getBinaryFile()`       | Yes                                        | Retrieves a binary blob. Used to download CAD geometry           |
| `getJsonFile()`         | Yes                                        | Retrieves JSON data. This is used to store some metadata about models |
| `headers: HttpHeaders`  | Only used for point clouds.                | Headers used during point cloud streaming. Useful if you e.g. need to provide authentication headers to the requests |

See [API documentation](../API%20Reference#interfaces_cognite_reveal_extensions_datasourcemodeldataprovidermd).

### Example implementation

```js
import { ModelDataProvider } from '@cognite/reveal/extensions/datasource';

class MyModelDataProvider implements ModelDataProvider {
  public readonly headers: HttpHeaders = {};

  async getJsonFile(baseUrl: string, fileName: string): Promise<any> {
    const url = `${baseUrl}/${fileName}`;
    const response = await fetch(url);
    if (!response.ok) {
      throw new Error(`Could not fetch '${url}'`);
    }
    return response.json();
  }

  async getBinaryFile(baseUrl: string, fileName: string): Promise<ArrayBuffer> {
    const url = `${baseUrl}/${fileName}`;
    const response = await fetch(url);
    if (!response.ok) {
      throw new Error(`Could not fetch '${url}'`);
    }
    return response.arrayBuffer();
  }
}
```

## ModelMetadataProvider

`ModelMetadataProvider` is responsible for determining the "base URL" for a model, determine
the "model transformation" and the default camera.

Implementations can assume that all identifiers will be of type 
[`CdfModelIdentifier`]():
```js
class CdfModelIdentifier implements ModelIdentifier {
  readonly revealInternalId: symbol;
  readonly modelFormat: File3dFormat;
  readonly modelId: number;     // CDF ModelID
  readonly revisionId: number;  // CDF RevisionID
}
```

| Function/Field          | Required?                                  | Description                                                      |
| ----------------------- | ------------------------------------------------------------------------------------------------------------- |
| `getModelUrl()`         | Yes                                        | Determine the base URL that will be used when download metadata and geometry using `ModelDataProvider`. |
| `getModelCamera()`      | No - return `undefined` to use default     | Return an initial camera pose for the model                      |
| `getModelMatrix()`      | Yes, but value can be hardcoded.           | Returns an transformation matrix for transforming from stored coordinates to Reveal coordinates (see below) |

`getModelMatrix()` is responsible for converting from stored geometry coordinates to Reveal coordinates (left-handed, Y up). This 
is required for CAD models stored 